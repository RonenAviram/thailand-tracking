
<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>×ª××™×œ× ×“ 2026 | ×“×©×‘×•×¨×“ ××©×¤×—×ª ××‘×™×¨×</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Heebo -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PapaParse for CSV processing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        tropical: {
                            turquoise: '#40E0D0',
                            ocean: '#008080',
                            sun: '#FFD700',
                            leaf: '#2D5A27',
                            sky: '#E0F7FA',
                            pink: '#FF69B4',
                            shake: '#FFECB3'
                        }
                    },
                    borderRadius: {
                        '4xl': '2.5rem',
                        '5xl': '3.5rem',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Heebo', sans-serif;
            background: linear-gradient(135deg, #e0f7fa 0%, #fffde7 100%);
            background-attachment: fixed;
            color: #1e293b;
        }

        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 10px 40px -10px rgba(31, 38, 135, 0.1);
        }

        .shake-circle {
            width: 220px;
            height: 220px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: white;
            border: 8px solid #FFD700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
        }

        .whatsapp-bubble {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 1.25rem;
            position: relative;
            margin-bottom: 8px;
        }

        .bubble-funny { background: #e7fed3; border-top-right-radius: 2px; align-self: flex-start; }
        .bubble-weird { background: #f3e5f5; border-top-right-radius: 2px; align-self: flex-start; }

        .tropical-gradient-text {
            background: linear-gradient(to left, #008080, #FF69B4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .loader {
            border-top-color: #40E0D0;
            animation: spinner 1.5s linear infinite;
        }

        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Gauge Container */
        .gauge-container {
            height: 140px;
            position: relative;
        }
    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body class="min-h-screen p-4 md:p-8">

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 z-50 flex items-center justify-center bg-white/90 backdrop-blur-md">
        <div class="flex flex-col items-center">
            <div class="loader w-14 h-14 border-4 border-sky-200 rounded-full mb-4"></div>
            <p class="text-ocean font-bold text-xl">××¢×“×›×Ÿ × ×ª×•× ×™× ××ª××™×œ× ×“...</p>
        </div>
    </div>

    <div class="max-w-4xl mx-auto space-y-10">
        
        <!-- Header -->
        <header class="text-center">
            <h1 class="text-4xl md:text-6xl font-black tracking-tight tropical-gradient-text mb-2">
                ×ª××™×œ× ×“ 2026
            </h1>
            <p class="text-lg md:text-xl font-bold text-sky-800">× ×¨×™×”, ×¨×•× ×Ÿ, ×–×™×•, ×¡×”×¨ ×•×¢×™×œ×™</p>
            <div id="lastUpdatedBox" class="inline-block mt-3 px-4 py-1 bg-white/40 rounded-full text-xs font-bold text-sky-900/60 hidden">
                <i class="fa-solid fa-clock ml-1"></i>
                <span id="lastUpdatedText"></span>
            </div>
        </header>

        <!-- Status Card (Where are we) -->
        <div class="glass px-6 py-4 rounded-3xl flex items-center justify-between border-r-8 border-tropical-ocean">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-tropical-ocean text-white rounded-2xl flex items-center justify-center text-xl shadow-lg">
                    <i class="fa-solid fa-plane-departure"></i>
                </div>
                <div>
                    <h3 class="text-sm font-bold text-sky-600/70">××™×¤×” ×× ×—× ×• ×¢×›×©×™×•?</h3>
                    <p id="locationVal" class="text-2xl font-black text-sky-900">×˜×•×¢×Ÿ...</p>
                </div>
            </div>
            <div id="locationFlag" class="text-3xl opacity-40">ğŸ‡¹ğŸ‡­</div>
        </div>

        <!-- Shake Hero Section (Scorecard) -->
        <section class="flex flex-col items-center gap-6">
            <div class="shake-circle group transition-transform hover:scale-105 duration-500">
                <span class="text-sm font-bold text-amber-600 mb-1">×©×™×™×§×™× ×œ×”×™×•×</span>
                <span id="shakesToday" class="text-7xl font-black text-sky-900">0</span>
                <div class="mt-2 text-amber-500 text-2xl">ğŸ¥¤</div>
            </div>
            <div class="bg-white/60 backdrop-blur px-8 py-3 rounded-full shadow-sm border border-amber-100">
                <p class="text-sky-900 font-bold">
                    ×¡×”"×› ××ª×—×™×œ×ª ×”×˜×™×•×œ: 
                    <span id="shakesTotal" class="text-amber-600 text-xl font-black">0</span>
                </p>
            </div>
        </section>

        <!-- Gauges Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Fun Gauge -->
            <div class="glass p-6 rounded-4xl text-center">
                <h3 class="font-black text-lg mb-2 flex items-center justify-center gap-2">
                    <i class="fa-solid fa-face-grin-stars text-tropical-sun"></i>
                    ××“×“ ×”×¤××Ÿ
                </h3>
                <div class="gauge-container">
                    <canvas id="funGauge"></canvas>
                </div>
                <p id="funValText" class="text-3xl font-black -mt-4 text-sky-900">0/10</p>
            </div>

            <!-- Complaint Gauge -->
            <div class="glass p-6 rounded-4xl text-center">
                <h3 class="font-black text-lg mb-2 flex items-center justify-center gap-2">
                    <i class="fa-solid fa-face-angry text-rose-400"></i>
                    ××“×“ ×”×§×™×˜×•×¨×™×
                </h3>
                <div class="gauge-container">
                    <canvas id="complaintGauge"></canvas>
                </div>
                <p id="complaintValText" class="text-3xl font-black -mt-4 text-sky-900">0/10</p>
            </div>
        </div>

        <!-- The Feed (Quotes) -->
        <section class="space-y-4">
            <h2 class="text-2xl font-black px-2 flex items-center gap-2 text-sky-900">
                <i class="fa-solid fa-comment-dots text-tropical-ocean"></i>
                ××”×©×˜×— (×”×¦×™×˜×•×˜×™× ×”××—×¨×•× ×™×)
            </h2>
            <div id="feedContainer" class="flex flex-col gap-3">
                <!-- Messages injected here -->
            </div>
        </section>

        <!-- Action Bar -->
        <footer class="flex flex-col items-center py-10 gap-4">
            <button onclick="fetchData()" class="bg-white hover:bg-tropical-sky text-tropical-ocean w-16 h-16 rounded-full flex items-center justify-center shadow-xl transition-all active:scale-90 border-4 border-white">
                <i class="fa-solid fa-sync text-2xl"></i>
            </button>
            <p class="text-gray-400 text-sm font-bold">××©×™×›×ª × ×ª×•× ×™× ×—×™×” â€¢ ×¢×“×›×•×Ÿ ××•×˜×•××˜×™</p>
        </footer>

    </div>

    <script>
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTWIO-PFUSmBMbPAJ4mLvzCx8f6xy_Qqiy890CUKtd1CArENuFdKxryHP2G0q_Rx97u8nb59TdSFfCT/pub?output=csv';
        let charts = {};

        // Helper: Count Up Animation
        function animateValue(id, start, end, duration) {
            const obj = document.getElementById(id);
            if (start === end) {
                obj.innerText = end;
                return;
            }
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerText = Math.floor(progress * (end - start) + start);
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        // Initialize Gauge Chart
        function createGauge(id, value, color) {
            const ctx = document.getElementById(id).getContext('2d');
            
            // Destroy existing if refresh
            if (charts[id]) charts[id].destroy();

            charts[id] = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [value, 10 - value],
                        backgroundColor: [color, '#f1f5f9'],
                        borderWidth: 0,
                        circumference: 180,
                        rotation: 270,
                        borderRadius: 20,
                        cutout: '80%'
                    }]
                },
                options: {
                    aspectRatio: 1.8,
                    plugins: { tooltip: { enabled: false }, legend: { display: false } },
                    events: []
                }
            });
        }

        async function fetchData() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
            
            try {
                const response = await fetch(`${CSV_URL}&cachebust=${Date.now()}`);
                const csvData = await response.text();
                
                Papa.parse(csvData, {
                    header: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        processData(results.data);
                        document.getElementById('loadingOverlay').classList.add('hidden');
                    }
                });
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('loadingOverlay').classList.add('hidden');
            }
        }

        function processData(data) {
            if (!data || data.length === 0) return;

            const latest = data[data.length - 1];
            
            // 1. Location & Flag logic
            const location = latest['××™×¤×” ×× ×—× ×•'] || '×¢×“×™×™×Ÿ ×œ× ××™×œ×× ×•...';
            document.getElementById('locationVal').innerText = location;
            
            const flagEl = document.getElementById('locationFlag');
            if (location.includes('×‘×ª×™×”') || location.includes('×™×©×¨××œ') || location.includes('× ××œ ×ª×¢×•×¤×” ×‘×Ÿ ×’×•×¨×™×•×Ÿ')) {
                flagEl.innerText = 'ğŸ‡®ğŸ‡±';
            } else {
                flagEl.innerText = 'ğŸ‡¹ğŸ‡­';
            }

            // 2. Shakes (Daily & Sum)
            const dailyShakes = Math.max(0, parseInt(latest['×›××” ×©×™×™×§×™× ×©×ª×™× ×• ×”×™×•×']) || 0);
            animateValue('shakesToday', 0, dailyShakes, 1500);

            const totalShakes = data.reduce((sum, row) => {
                return sum + (Math.max(0, parseInt(row['×›××” ×©×™×™×§×™× ×©×ª×™× ×• ×”×™×•×']) || 0));
            }, 0);
            animateValue('shakesTotal', 0, totalShakes, 2000);

            // 3. Gauges
            const fun = Math.min(10, Math.max(0, parseInt(latest['××“×“ ×”×¤××Ÿ']) || 0));
            const complaints = Math.min(10, Math.max(0, parseInt(latest['××“×“ ×”×§×™×˜×•×¨×™×']) || 0));

            const funColor = fun >= 8 ? '#10b981' : '#40E0D0';
            const compColor = complaints >= 5 ? '#f43f5e' : '#fbbf24';

            document.getElementById('funValText').innerText = `${fun}/10`;
            document.getElementById('complaintValText').innerText = `${complaints}/10`;

            createGauge('funGauge', fun, funColor);
            createGauge('complaintGauge', complaints, compColor);

            // 4. Timestamp
            const timestampKey = Object.keys(latest)[0]; // Usually first column
            if (latest[timestampKey]) {
                document.getElementById('lastUpdatedText').innerText = latest[timestampKey];
                document.getElementById('lastUpdatedBox').classList.remove('hidden');
            }

            // 5. The Feed (Last 5)
            const feedContainer = document.getElementById('feedContainer');
            feedContainer.innerHTML = '';
            
            const lastFive = data.slice(-5).reverse();
            
            lastFive.forEach(row => {
                const time = row[timestampKey] || '';
                const funny = row['×”×“×‘×¨ ×”×›×™ ××¦×—×™×§ ×©×§×¨×” ×”×™×•×'];
                const weird = row['×”×“×‘×¨ ×”×›×™ ××•×–×¨ ×©×¨××™× ×•'];

                if (funny && funny.trim() !== '') {
                    addFeedItem(feedContainer, funny, 'funny', time);
                }
                if (weird && weird.trim() !== '') {
                    addFeedItem(feedContainer, weird, 'weird', time);
                }
            });
            
            if (feedContainer.children.length === 0) {
                feedContainer.innerHTML = '<p class="text-center text-gray-400 py-4">××—×›×™× ×œ×¦×™×˜×•×˜ ×”×¨××©×•×Ÿ...</p>';
            }
        }

        function addFeedItem(container, text, type, time) {
            const div = document.createElement('div');
            div.className = `whatsapp-bubble shadow-sm ${type === 'funny' ? 'bubble-funny' : 'bubble-weird'}`;
            
            const icon = type === 'funny' ? 'ğŸ˜‚' : 'ğŸ§';
            const label = type === 'funny' ? '××©×”×• ××¦×—×™×§' : '××©×”×• ××•×–×¨';
            
            div.innerHTML = `
                <div class="flex items-center gap-2 mb-1">
                    <span class="text-xs font-black uppercase opacity-40">${label} ${icon}</span>
                </div>
                <p class="text-sky-900 font-medium leading-tight">${text}</p>
                <div class="text-[10px] text-left opacity-30 mt-1 font-bold">${time}</div>
            `;
            container.appendChild(div);
        }

        // Init
        window.onload = fetchData;
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
